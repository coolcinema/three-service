"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.GenCommand = void 0;
const conflict_resolver_service_1 = require("../services/conflict-resolver.service");
const config_manager_service_1 = require("../services/config-manager.service");
const buf_runner_service_1 = require("../services/buf-runner.service");
const post_processor_service_1 = require("../services/post-processor.service");
const chalk_1 = __importDefault(require("chalk"));
class GenCommand {
    async execute() {
        const rootDir = process.cwd();
        const conflictResolver = new conflict_resolver_service_1.NodeModulesConflictResolver();
        const configManager = new config_manager_service_1.ConfigManager(rootDir);
        const bufRunner = new buf_runner_service_1.BufRunner(rootDir);
        const postProcessor = new post_processor_service_1.PostProcessor();
        console.log(chalk_1.default.blue("üöÄ Starting Generation Pipeline"));
        try {
            await conflictResolver.resolve(rootDir);
            if (!configManager.prepare())
                return;
            bufRunner.clean();
            if (!bufRunner.run())
                process.exit(1);
        }
        finally {
            configManager.restore();
        }
        await postProcessor.run();
        console.log(chalk_1.default.green("üèÅ Pipeline finished."));
    }
}
exports.GenCommand = GenCommand;
//# sourceMappingURL=gen.command.js.map