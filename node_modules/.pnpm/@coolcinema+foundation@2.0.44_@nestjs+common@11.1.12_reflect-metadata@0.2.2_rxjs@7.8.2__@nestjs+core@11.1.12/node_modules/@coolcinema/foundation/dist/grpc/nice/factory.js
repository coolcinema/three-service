"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createClients = createClients;
const nice_grpc_1 = require("nice-grpc");
const middleware_1 = require("./middleware");
const factory = (0, nice_grpc_1.createClientFactory)().use(middleware_1.clientMiddleware);
function createClients(registry, definitions, serviceMap) {
    const clients = {};
    for (const [key, def] of Object.entries(definitions)) {
        const slug = serviceMap?.[key] || key;
        const serviceConfig = registry.services[slug];
        if (!serviceConfig?.grpc?.main) {
            console.warn(`⚠️ No gRPC config for ${slug}`);
            continue;
        }
        const address = `${serviceConfig.host}:${serviceConfig.grpc.main.port}`;
        const channel = (0, nice_grpc_1.createChannel)(address, nice_grpc_1.ChannelCredentials.createInsecure());
        clients[key] = factory.create(def, channel);
    }
    return clients;
}
//# sourceMappingURL=factory.js.map