"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initTelemetry = initTelemetry;
const sdk_node_1 = require("@opentelemetry/sdk-node");
const auto_instrumentations_node_1 = require("@opentelemetry/auto-instrumentations-node");
const exporter_trace_otlp_grpc_1 = require("@opentelemetry/exporter-trace-otlp-grpc");
const api_1 = require("@opentelemetry/api");
api_1.diag.setLogger(new api_1.DiagConsoleLogger(), api_1.DiagLogLevel.INFO);
function initTelemetry(serviceName) {
    const sdk = new sdk_node_1.NodeSDK({
        serviceName: serviceName,
        traceExporter: new exporter_trace_otlp_grpc_1.OTLPTraceExporter({
            url: process.env.OTEL_EXPORTER_OTLP_ENDPOINT ||
                "http://cool-infra-jaeger-collector.coolcinema.svc.cluster.local:4317",
        }),
        instrumentations: [
            (0, auto_instrumentations_node_1.getNodeAutoInstrumentations)({
                "@opentelemetry/instrumentation-fs": { enabled: false },
            }),
        ],
    });
    sdk.start();
    console.log(`ðŸ“¡ Telemetry initialized for ${serviceName}`);
    process.on("SIGTERM", () => {
        sdk
            .shutdown()
            .then(() => console.log("Telemetry terminated"))
            .catch((error) => console.log("Error terminating telemetry", error))
            .finally(() => process.exit(0));
    });
}
//# sourceMappingURL=index.js.map